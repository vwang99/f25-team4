<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sign Up</title>
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<div class="header">
		<span class="header-title">Tether</span>
		<nav class="nav-links">
			<div class="nav-left">
				<a href="index.html#chatRoomsList" class="nav-link">Chat Rooms</a>
				<a href="profile.html" class="nav-link">Profile</a>
				<a href="signup.html" class="nav-link">Sign Up</a>
			</div>
			<div class="nav-right"></div>
		</nav>
	</div>

	<div class="form-container">
		<h2>Sign Up</h2>
		<form class="login-form" id="signupForm" autocomplete="on">
			<input type="text" id="su_username" name="username" placeholder="Username" required autofocus>
			<input type="email" id="su_email" name="email" placeholder="Email" required>
			<input type="password" id="su_password" name="password" placeholder="Password (min 6 chars)" required>
			<input type="password" id="su_password_confirm" name="password_confirm" placeholder="Confirm password" required>
			<button type="submit" id="signupSubmit">Create account</button>
		</form>
		<div style="margin-top:10px;color:#003366;">Already have an account? <a href="login.html" style="color:#003366;font-weight:600;text-decoration:underline;">Login</a></div>
		<div class="success-message" id="signupSuccess" style="display:none;"></div>
	</div>

	<script>
		const signupForm = document.getElementById('signupForm');
		const successEl = document.getElementById('signupSuccess');
		signupForm.addEventListener('submit', async function(e) {
			e.preventDefault();
			const username = document.getElementById('su_username').value.trim();
			const email = document.getElementById('su_email').value.trim();
			const pw = document.getElementById('su_password').value;
			const pwc = document.getElementById('su_password_confirm').value;
			if (pw.length < 6) {
				successEl.style.display = 'block';
				successEl.textContent = 'Password must be at least 6 characters.';
				return;
			}
			if (pw !== pwc) {
				successEl.style.display = 'block';
				successEl.textContent = 'Passwords do not match.';
				return;
			}
			// Try creating user via API
			try {
				const payload = { username: username, email: email, password: pw, phoneNumber: '' };
				const res = await fetch('/users', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
				if (!res.ok) throw new Error('Failed to create user');
				const created = await res.json();
				// set the logged-in user and redirect to profile
				try { localStorage.setItem('loggedInUser', created.getUsername ? created.getUsername() : created.username); } catch (err) { window.loggedInUser = created.username; }
				successEl.style.display = 'block';
				successEl.textContent = 'Account created — redirecting...';
				setTimeout(() => { window.location.href = 'profile.html'; }, 600);
			} catch (err) {
				// fallback to local-only behavior
				try { localStorage.setItem('loggedInUser', username); } catch (err2) { window.loggedInUser = username; }
				successEl.style.display = 'block';
				successEl.textContent = 'Account created locally (server unavailable) — redirecting...';
				setTimeout(() => { window.location.href = 'profile.html'; }, 600);
			}
		});
	</script>
	<script src="main.js"></script>
</body>
</html>
